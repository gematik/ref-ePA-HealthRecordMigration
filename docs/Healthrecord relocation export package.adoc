ifndef::env-github[]
ifndef::imagesdir[:imagesdir: ../../images]
ifndef::plantumlsimages[:plantumlsimages: plantuml]
ifndef::chapterplantumlsdir[:chapterplantumlsdir: ../../src/plantuml]
endif::[]
ifdef::env-github[]
:source-highlighter: rouge
:icons:
:imagesdir: ../../images
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
:plantumlsimages: plantuml
:plantumlsdir: ../../src/plantuml
:xrefstyle: full
:sectanchors:
:numbered:
:sectnums:
endif::[]

ifdef::env-github[]
image::Gematik_Logo_Flag.png[gematik,width=20%,float="right"]
endif::[]

toc::[]


[cols="1,4",options="header"]
|===
|Version
|

|1.0.0
|erste Version für ePA-Aktensysteme ab Release 3.1.x
|1.0.1
|Hinweise zur Reihenfolge der Artefakte im Zip-File
|1.1.0
|Ergänzung von Ressourcen in medication sowie deren Reihenfolge
|===


:sectnums:

[#_exportpackage]
== Exportpaket (Daten)

Definition der Formate für die bei einem Anbieterwechsel in einem Exportpaket zu übertragenen Daten eines ePA Aktenkontos.

=== Zip-Datei

Die einzelnen Artefakte eines Aktenkontos werden in einer einzelnen Zip-Datei mit folgender Struktur abgelegt: 

[cols="1,1,2a,2a,1"]
|===
|Root
|Pfad (Verzeichnis)
|Elemente (Datei(en))
|Inhalt
|see

|ZIP/ ||||

||IHE_XDS/|gemäß <<ITI-TF2>>, ITI-32|XDS Dokumente| <<IHE_XDS>>
||Medication/|M_nnnnnn.json { 0 .. * }|FHIR Resourcen| <<Medication>>
||AuditEvents/|A_nnnnnn.json { 0 .. * }|Audit Events| <<AuditEvents>>
||Entitlements/|E_nnnnnn.json { 0 .. * }|Befugnisse| <<Entitlements>>
||(root)|Consents.json {1 .. 1}|Widersprüche gegen Funktionen der ePA| <<Consents>>
||(root)|ResearchDataPurposes.json {1 .. 1}|Verwendungszwecke für Forschungsdaten| <<Consents>>
||(root)|Constraints.json {1 .. 1}|verborgene Elemente| <<Constraints>>
||(root)|EmailOwner.json {1 .. 1}|E-Mail Adresse Versicherter| <<Emails>>
||(root)|Emails.json {1 .. 1}|E-Mail Adressen Vertreter| <<Emails>>
||(root)|BlockedUsers.json {1 .. 1}|ausgeschloßene Nutzer| <<BlockedUsers>>
|===

Einzelne Datenelemente des Aktenkontos, beispielsweise ein spezifisches Entitlement, eine konkrete Consent Decision, ein bestimmtes XDS Dokument, sind jeweils nur einmalig gemäß obiger Tabelle in die Zip-Datei aufzunehmen (keine Duplikate).

Die Komprimierung der Zip-Datei erfolgt mit Kompressionsmethode 'no compression' (0) oder 'Deflate' (8) gemäß der Vorgaben in  <<zip>>.

Die Zip-Datei wird mit Dateinamen 'Data.zip' in das Exportpaket übernommen.

Innerhalb der Zip-Datei darf es kein Interleaving geben. Alle Einträge mit gleichem Pfad müssen aufeinanderfolgen und sollen nicht abwechselnd mit Einträgen eines abweichenden Pfades vorkommen.

Werden Einträge (Ressourcen, Dateien) von weiteren Einträgen referenziert, so sind die referenzierten Einträge in der Reihenfolge vor den referenzierenden Einträgen in die Zip-Datei aufzunehmen. Bei einer sequentiellen Auswertung der Datei werden die referenzierten Einträge dann zuerst gelesen wurden und sind bei der Verarbeitung der referenzierenden Elemente dann schon bekannt.

---
==== IHE_XDS
Der Export der Daten des XDS Document Service erfolgt analog zum Vorgehen in ePA-2.6. 
Policy Documents sind nicht mehr vorhanden und werden daher nicht berücksichtigt. Audit Events werden gemäß der Vorgaben in <<AuditEvents>> in das Exportpaket aufgenommen. 

Im Ordner IHE_XDS werden alle Dokumente und alle Metadaten gemäß IHE ITI Cross-Enterprise Document Media Interchange (XDM) - Distribute Document Set on Media [ITI-32] für den Export abgelegt (<<ITI-TF2>>).

Abweichend von den Vorgaben aus [ITI-32] muss:

* der ursprüngliche Inhalt von DocumentEntry.URI in das Metadatum DocumentEntry.originalURI kopiert werden. DocumentEntry.originalURI wird ausschließlich im Rahmen des Aktenumzugs verwendet (d.h. es ist kein Metadatum von XDS-Registry) und wie die anderen Metadaten auch in METADATA.XML übertragen.
* für Dokumente ohne DocumentEntry.title dieses Metadatum mit dem auf den reinen Dateinamen reduzierten Wert (d.h. ohne Pfadangaben) von documentEntry.URI befüllt und in METADATA.XML übernommen werden.

===== Reihenfolge und Sortierung der Submission Sets
Innerhalb der Daten zu IHE_XDS in der Zip-Datei des Exportpakets werden Submission Sets so angeordnet, dass bei sequentiellem Lesen keine 'Dangling Pointer' auftreten, d.h. keine Assoziationen, deren Ziel (Folder oder Document Entry) noch nicht gelesen wurde, sondern erst im weiteren Verlauf der Zip-Datei enthalten ist

---
==== Medication
Innerhalb dieses Verzeichnisses werden alle Daten des Medical Service 'medication' abgelegt.

Jede FHIR-Resource wird dabei im Format JSON als jeweils eine Datei abgelegt. Der Dateiname ist M_nnnnnn.json mit 'nnnnnn' aus der Menge {000000, 999999}, beginnend mit 'nnnnnn' = 000000 und fortlaufender Zählung.

Die jeweils enthaltene FHIR-Resource einer Datei ist innerhalb der JSON Struktur über das Attribut "resourceType" identifizerbar, das spezifische Profil der Resource über das Attribut "meta.profile".

Die exportierbaren FHIR-Resourcen verwenden teilweise Referenzen auf weitere Resourcen ("reference"). Zur Vermeidung nicht auflösbarer Referenzen bei einem Import des Exportpakets werden die Resourcen in der vorgegebenen Reihenfolge angeordnet, so dass referenzierte Resourcen vor dem Import von Resourcen mit Referenzen schon bekannt sind.

Zusätzlich müssen bei der Migration alle Versionen der FHIR-Instanzen berücksichtigt werden. Dabei ist sicherzustellen, dass die `Resource.id` über alle Versionen hinweg konstant bleibt, während die Attribute `Resource.meta.versionId` und `Resource.meta.lastUpdated` in jede Version korrekt übernommen werden. Es muss gewährleistet sein, dass bei der Migration nur die jeweils aktuellste FHIR-Instanz mit der höchsten Resource.meta.versionId über die Standard-Query-API abrufbar ist. Frühere Versionen der Instanzen dürfen nicht direkt über die Standard-Query-API abgerufen werden, sondern sind über die URL-Struktur `[base]/[resourceType]/[id]/_history/[versionId]` zugänglich. Diese Versionsverwaltung ermöglicht es, auch auf ältere FHIR-Instanzen zurückzugreifen, ohne die Konsistenz der aktuellen Daten zu beeinträchtigen.

Die Resourcenreihenfolge im Exportpaket ergibt sich zu: 

. Organization
. Practitioner
. PractitionerRole (enthält Referenzen auf Organization und Practitioner)
. Medication
. MedicationRequest (enthält Referenzen auf Medication und PractitionerRole)
. MedicationDispense (enthält Referenzen auf Medication und Organization)
. MedicationStatement (enthält Referenzen auf Medication, Organization, PractitionerRole, Practitioner)
. Observation (enthält Referenzen auf Organization, PractitionerRole, Practitioner)
. AllergyIntolerance (enthält Referenzen auf Organization, PractitionerRole, Practitioner)
. RelatedPerson
. List (enthält Referenzen auf MedicationStatement, Observation, AllergyIntolerance, Organization, PractitionerRole, Practitioner)
. Composition (enthält Referenzen auf List, Observation, Organization, PractitionerRole, Practitioner)
. Provenance (enthält Referenzen auf Medication, MedicationDispense, MedicationRequest, MedicationStatement, Observation, AllergyIntolerance, Organization, PractitionerRole, Practitioner)
. Task (enthält Referenzen auf MedicationStatement, Organization, PractitionerRole, Practitioner)

Bei einem Import sollen die einzelnen Dateien gemäß der Dateinummerierung, startend bei M_000000.json, verarbeitet werden. D.h.: Alle Nummerierungen der Dateien mit Resourcen des Typs 'Organization' sind kleiner als jede Nummerierung der Dateien mit Resourcen des Typs 'Practitioner' und alle Nummerierungen zu 'Practitioner' sind kleiner als jede Nummerierung zu 'PractitionerRole'. 

Schema: https://simplifier.net/epa-medication

Beispiel: Inhalt M_123456.json (Resource: 'Medication')

[source,json]
----
{
  "resourceType": "Medication",
  "id": "2cb57b8b-bd90-46da-8a3d-d265e40bc3d1",
  "meta": {
    "versionId": "1",
    "lastUpdated": "2025-08-21T14:40:00.000Z",
    "profile": [
      "https://gematik.de/fhir/epa-medication/StructureDefinition/epa-medication"
    ]
  },
  "extension": [
    {
      "url": "https://gematik.de/fhir/epa-medication/StructureDefinition/epa-medication-type-extension",
      "valueCoding": {
        "code": "781405001",
        "system": "http://snomed.info/sct",
        "version": "http://snomed.info/sct/11000274103/version/20240515",
        "display": "Medicinal product package (product)"
      }
    }
  ],
  "identifier": [
    {
      "system": "https://gematik.de/fhir/epa-medication/sid/epa-medication-unique-identifier",
      "value": "F78C093639F9C1AD216341E77BE87E265B6A04BF4C830E4C010676146D035CA6"
    }
  ],
  "code": {
    "coding": [
      {
        "system": "http://fhir.de/CodeSystem/ifa/pzn",
        "code": "08545331",
        "display": "IBU-ratiopharm 800mg akut Schmerztabletten"
      },
      {
        "system": "http://fhir.de/CodeSystem/bfarm/atc",
        "code": "M01AE01",
        "display": "Ibuprofen",
        "version": "2022"
      }
    ]
  },
  "form": {
    "coding": [
      {
        "system": "https://fhir.kbv.de/CodeSystem/KBV_CS_SFHIR_KBV_DARREICHUNGSFORM",
        "code": "TAB",
        "display": "Tabletten",
        "version": "1.10"
      },
      {
        "system": "http://standardterms.edqm.eu",
        "code": "12200",
        "display": "Tablet"
      },
      {
        "system": "http://snomed.info/sct",
        "code": "385055001",
        "version": "http://snomed.info/sct/11000274103/version/20240515",
        "display": "Tablet (basic dose form)"
      }
    ]
  },
  "status": "active",
  "amount": {
    "numerator": {
      "value": 50,
      "code": "{Tablet}",
      "system": "http://unitsofmeasure.org",
      "unit": "Tablet"
    },
    "denominator": {
      "value": 1,
      "code": "{Package}",
      "system": "http://unitsofmeasure.org",
      "unit": "Package"
    }
  },
  "ingredient": [
    {
      "itemCodeableConcept": {
        "coding": [
          {
            "code": "387207008",
            "system": "http://snomed.info/sct",
            "version": "http://snomed.info/sct/11000274103/version/20240515",
            "display": "Ibuprofen (substance)"
          }
        ]
      },
      "strength": {
        "numerator": {
          "value": 400,
          "code": "mg",
          "system": "http://unitsofmeasure.org",
          "unit": "MilliGram"
        },
        "denominator": {
          "value": 1,
          "code": "{Tablet}",
          "system": "http://unitsofmeasure.org",
          "unit": "Tablet"
        }
      }
    }
  ]
}
----

---
==== AuditEvents
Innerhalb dieses Verzeichnisses werden alle Daten des Audit Event Services abgelegt.

Berücksichtigt werden dabei nur Audit Event FHIR-Resourcen und keinerlei gerenderte Auszüge (PDFs).

Jede FHIR-Resource des Typs "AuditEvent" (Profil: epa-auditevent) wird dabei im Format JSON als jeweils eine Datei abgelegt. Der Dateiname ist A_nnnnnn.json mit 'nnnnnn' aus der Menge {000000, 999999}, beginnend mit 'nnnnnn' = 000000 und fortlaufender Zählung.

Schema: https://simplifier.net/epa/epaauditevent

Beispiel: Inhalt A_111111.json (Event: cancel medication dispense)

[source,json]
----
{
    "resourceType": "AuditEvent",
    "id": "epa-auditevent-example",
    "meta": {
        "profile":  [
            "https://gematik.de/fhir/epa/StructureDefinition/epa-auditevent"
        ]
    },
    "type": {
        "system": "http://terminology.hl7.org/CodeSystem/audit-event-type",
        "code": "rest",
        "display": "RESTful Operation"
    },
    "action": "U",
    "recorded": "2025-01-01T08:00:00Z",
    "outcome": "0",
    "agent":  [
        {
            "type": {
                "coding":  [
                    {
                        "system": "http://dicom.nema.org/resources/ontology/DCM",
                        "code": "110150",
                        "display": "Application"
                    }
                ]
            },
            "who": {
                "identifier": {
                    "system": "https://gematik.de/fhir/sid/telematik-id",
                    "value": "9-883110000012345"
                }
            },
            "altId": "9-883110000012345",
            "name": "E-Rezept-Fachdienst",
            "requestor": "false"
        }
    ],
    "source": {
        "observer": {
            "display": "Elektronische Patientenakte Fachdienst"
        },
        "type":  [
            {
                "system": "https://gematik.de/fhir/epa/CodeSystem/epa-auditevent-sourcetype-cs",
                "code": "MEDICATIONSVC",
                "display": "Medication Service"
            }
        ]
    },
    "entity":  [
        {
            "name": "Medical Service",
            "description": "operation:cancel-dispensation"
        }
    ]
}
----

---
==== Consents
Alle Entscheidungen zu widerspruchsfähigen Funktionen der ePA werden in einer JSON-Datei **Consents.json** zusammengefasst. 

Der grundsätzliche Widerspruch gegen die Nutzung der ePA ist nicht Bestandteil dieser Datei.

Schema:
[source,json]
----
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",  
  "$id": "https://gematik.de/schema-consents.json",  
  "title": "Consents",  
  "description": "Consent decision entries",  
  "type": "array",
  "items": {
    "type": "object",
    "properties": { 
      "functionClass": { 
        "type": "string",
        "enum": ["healthCareProcess", "research"]
      },
      "function": { 
        "type": "string",
        "enum": ["medication", "erp-submission", "research-submission"]
      },
      "consent": { 
        "type": "string",
        "enum": ["permit", "deny"]
      }
    }
  }
}
----

Beispiel: Inhalt Consents.json
[source,json]
----
[
	{
		"functionClass": "healthCareProcess",
		"function": "medication",
		"consent": "deny"
	},
	{
		"functionClass": "healthCareProcess",
		"function": "erp-submission",
		"consent": "permit"
	},
	{
		"functionClass": "research",
		"function": "research-submission",
		"consent": "permit"
	}
]
----

Alle Entscheidungen zu den Verwendungszwecken für übermittelte Daten für Forschungszwecke werden in einer JSON-Datei **ResearchDataPuposes.json** zusammengefasst. Diese Datei ist immer vorhanden, auch dann, wenn grundsätzlich gegen die Freigabe von Daten für Forschungszwecke entschieden wurde (siehe Consent "research-subission" == "deny")

Schema:
[source,json]
----
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",  
  "$id": "https://gematik.de/schema-researchDataPurposes.json",
  "title": "Research Data Purposes",
  "description": "Consents on research data purposes",
  "type": "array",
  "items": {
    "type": "object",
    "properties": {
      "purposeClass": {
        "type": "string",
        "enum": ["Purpose1", "Purpose2", "Purpose3", "Purpose4", "Purpose5", "Purpose6", "Purpose7", "Purpose8", "Purpose9", "Purpose10"]
      },
      "consent": {
        "type": "string",
        "enum": ["permit", "deny"]
      }
    }
  }
}
----

Beispiel: Inhalt ResearchDataPurposes.json
[source,json]
----
  [
    {
      "purposeClass": "Purpose1",
      "consent": "permit"
    },
    {
      "purposeClass": "Purpose2",
      "consent": "permit"
    },
    {
      "purposeClass": "Purpose3",
      "consent": "deny"
    },
    {
      "purposeClass": "Purpose4",
      "consent": "permit"
    },
    {
      "purposeClass": "Purpose5",
      "consent": "permit"
    },
    {
      "purposeClass": "Purpose6",
      "consent": "permit"
    },
    {
      "purposeClass": "Purpose7",
      "consent": "permit"
    },
    {
      "purposeClass": "Purpose8",
      "consent": "permit"
    },
    {
      "purposeClass": "Purpose9",
      "consent": "permit"
    },
    {
      "purposeClass": "Purpose10",
      "consent": "permit"
    }
  ]
----


==== Constraints
Alle Einträge (Assignments) der General Deny Policy werden in einer JSON-Datei **Constraints.json** zusammengefasst.

Schema:
[source,json]
----
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",  
  "$id": "https://gematik.de/schema-constraints.json",  
  "title": "Constraints",  
  "description": "Entries of the general deny policy",  
  "type": "array",
  "items": {
    "oneOf": [
        {
          "type": "object",
          "properties":{
            "policyType": {
              "type": "string",
              "enum": ["gdp"]
            },
            "denyType": {
              "type": "string",
              "enum": ["document"]
            },
            "rootDocumentId": { 
              "type": "string"
            }
          }
        },
        {
          "type": "object",
          "properties":{
            "policyType": {
              "type": "string",
              "enum": ["gdp"]
            },
            "denyType": {
              "type": "string",
              "enum": ["folder"]
            },
            "folderUUID": { 
              "type": "string"
            }
          }
        },
        {
          "type": "object",
          "properties":{
            "policyType": {
              "type": "string",
              "enum": ["gdp"]
            },
            "denyType": {
              "type": "string",
              "enum": ["category"]
            },
            "categoryId": { 
              "type": "string"
            }
          }
        }
    ]
  }
}
----

Beispiel: Inhalt Constraints.json mit 3 Einträgen
[source,json]
----
[
  {
    "policyType": "gdp",
    "denyType": "document",
    "rootDocumentId": "4fa70820-2384-4001-80a9-7bbd5e085efb^^^^urn:gematik:iti:xds:2023:rootDocumentUniqueId"
  },
  {
    "policyType": "gdp",
    "denyType": "category",
    "categoryId": "pregnancy_childbirth"
  },
  {
    "policyType": "gdp",
    "denyType": "folder",
    "folderUUID": "urn:uuid:4fa70820-2384-4001-80a9-7bbd5e085efb"
  }
]
----

---
==== Entitlements
Innerhalb dieses Verzeichnisses werden alle Daten des Entitlement Managements abgelegt.

Jedes Entitlement wird dabei als jeweils eine Datei abgelegt. Der Dateiname ist E_nnnnnn.json mit 'nnnnnn' aus der Menge {000000, 999999}, beginnend mit 'nnnnnn' = 000000 und fortlaufender Zählung.

Entitlements werden nicht direkt aus dem Aktenkonto in die Zip-Datei des Exportpakets übernommen. Die sicherheitsrelevanten Attribute, KVNR des Aktenkontos, actorId des befugten Nutzers (KVNR oder Telematik-Id) sowie das Ende der Gültigkeit der Befugnis (validTo), werden in einem JWT zusammengefasst (gemäß gemSpec_Aktensystem_ePAfueralle, A_25719*) und mit der Identität des Aktensystems (ID.FD.SIG) signiert. 
Bei einem Import im empfangenden Aktensystem muss dieses JWT mittels HSM Regel 'rr5' prüfbar sein. 

Die Elemente oid, displayName, issued-at, issued-actorId und issued-displayName werden unverändert übernommen und sind nicht Bestandteil des JWT.

Bei einem Import wird das JWT durch HSM Regel 'rr5' in eine CMAC gesicherte Befugnis konvertiert und mit den weiteren Daten (oid, displayName, ...) im neuen Aktenkonto abgelegt. 

  Inhalt des JWT:
    - protected_header:
      - "typ": "JWT"
      - "alg": "ES256" 
      - "x5c": signature certificate C.FD.SIG
    - payload:
      - "iat": issued at timestamp
      - "exp": expiry timestamp (always iat + 8 days)
      - "insurantid": the health record identifier this entitlement is assoctiated to
      - "actorId": Telematik-Id or KVNR
      - "validTo": Expiry date-time of entitlement in format according to rfc3339
    - signature: 
      - contains token signature


Schema für eine Befugnis:
[source,json]
----
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",  
  "$id": "https://gematik.de/schema-entitlement.json",  
  "title": "Entitlement",  
  "description": "An entitlment in an export package",  
  "type": "object",
  "properties": {
    "entitlement":{ 
      "description": "jwt containing the security relevant data",
      "type": "string"
    },
    "oid": { 
      "type": "string"
    },
    "displayName": { 
      "type": "string"
    },
    "issued-at":{ 
      "type": "string",
      "format": "date-time"
    },
    "issued-actorId": { 
      "type": "string"
    },
    "issued-displayName": {
      "type": "string"
    }
  },
  "additionalProperties": false
}
----

Beispiel: Inhalt E_000001.json

[source,json]
----
{
    "entitlement": "a jwt containing the security relevant data",
    "oid": "1.2.276.0.76.4.51",
    "displayName": "Zahnarztpraxis Hillary Gräfin Münchhausen",
    "issued-at": "2025-10-01T14:00:00Z",
    "issued-actorId": "X999999999",
    "issued-displayName": "Name of health record owner"
}
----

---
==== BlockedUsers
Alle Einträge (Assignments) der Blocked User Policy werden in einer JSON-Datei **BlockedUsers.json** zusammengefasst. Dabei wird auch 
der Zeitpunkt der Erstellung des Eintrags exportiert und unverändert in das importierende System übertragen. Das importierende System darf keine eigenen Zeitstempel (Zeitpunkt des Imports) für die Einträge verwenden.

Schema:
[source,json]
----
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",  
  "$id": "https://gematik.de/schema-blockedUsers.json",  
  "title": "Blocked users",  
  "description": "Entries of the blocked user policy in an export package",  
  "type": "array",
  "items": {
    "type": "object",
    "properties": {
      "actorId":{ 
        "type": "string"
      },
      "oid": { 
        "type": "string"
      },
      "displayName": { 
        "type": "string"
      },
      "at":{ 
        "type": "string",
        "format": "date-time"
      }
    }
  }
}
----

Beispiel: Inhalt BlockedUsers.json mit 4 Einträgen

[source,json]
----
 [
    {
      "actorId": "2-883110000092414",
      "oid": "1.2.276.0.76.4.51",
      "displayName": "Zahnarztpraxis Norbert Freiherr Schomaker",
      "at": "2025-07-01T12:00:00Z"
    },
    {
      "actorId": "1-883110000092404",
      "oid": "1.2.276.0.76.4.50",
      "displayName": "Praxis Dr. Annamaria Heckhausén",
      "at": "2025-07-02T12:00:00Z"
    },
    {
      "actorId": "2-883110000092427",
      "oid": "1.2.276.0.76.4.51",
      "displayName": "Zahnarztpraxis Dr. Alfons Adamiç",
      "at": "2025-07-03T12:00:00Z"
    },
    {
      "actorId": "3-883110000092469",
      "oid": "1.2.276.0.76.4.54",
      "displayName": "Süd Apotheke",
      "at": "2025-07-04T12:00:00Z"
    }
  ]
----

---
==== Emails
Die E-Mail Adresse des Versicherten (Owner des Aktenkontos) wird in einer Datei **EmailOwner.json** abgelegt. 
[source,json]
----
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",  
  "$id": "https://gematik.de/emailowner.json",  
  "title": "EmailOwner",  
  "description": "Email address of insurant in an export package",  
  "type": "array",
  "items": {
    "type": "string"
  }
}
----
Beispiel: Inhalt EmailOwner.json

[source,json]
----
[
    "firstName.lastNameOfHealthRecordOwner@example.com"
]
----



Die E-Mail Adressen der zum Zeitpunkt der Erstellung des Exportpakets befugten Vertreter des Versicherten werden in einer JSON-Datei **Emails.json** zusammengefasst. Es werden dabei jedoch ausschließlich die E-Mail Adressen derjenigen Vertreter berücksichtigt, deren Home-Aktensystem mit dem exportierenden Aktensystem identisch ist. E-Mail Adressen von Vertretern, deren Home-Aktensystem ein anderes Aktensystem ist, werden nicht berücksichtgt. 

Eine Vertrtetung liegt vor, wenn eine Befugnis existiert, deren actorid einer KVNR entspricht, aber nicht mit der KVNR des Aktenkontoinhabers übereinstimmt.

Die E-Mail Adressen der Vertreter werden durch das importierende Aktensystem nicht persistiert. Die importierten E-Mails Adressen aus dem Exportpaket zusammen mit den E-Mail Adressen von Vertretern, deren Home-Aktensystem schon dem importierenden Aktensystem entspricht, dienen bei erfolgreichem Import eines Aktenkontos lediglich dem Zweck der Benachrichtigung der Vertreter über den Umzug des vertretenen Aktenkontos.

Schema:
[source,json]
----
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",  
  "$id": "https://gematik.de/emails.json",  
  "title": "Emails",  
  "description": "Email addresses of representatives in an export package",  
  "type": "array",
  "items": {
    "type": "string"
  }
}
----

Beispiel: Inhalt Emails.json mit 4 Einträgen

[source,json]
----
[
  "m.mustermann@gematik.de",
  "max.mustermann@gematik.de",
  "max.mustermann123@gematik.de",
  "mustermann.max@ti.de"
]
----

---
[bibliography]
=== Verweise

* [[[zip]]] PKWARE APPNOTE.TXT - .ZIP File Format Specification.
Version: 6.3.10 
Revised: Nov 01, 2022
Copyright (c) 1989 - 2014, 2018, 2019, 2020, 2022 PKWARE Inc., All Rights Reserved.
https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT^

* [[[ITI-TF2]]] IHE IT Infrastructure (ITI) Technical Framework, Volume 2.
Revision 20.0
August 4, 2023
Copyright (c) 2000 — 2024 IHE International.
https://profiles.ihe.net/ITI/TF/Volume2/index.html